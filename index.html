<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>MedNote.AI – Trợ lý hồ sơ bệnh án</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .step-active {
      border-color: #1d4ed8;
      background-color: #eff6ff;
      color: #1d4ed8;
      font-weight: 600;
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-900">

<div class="min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="w-full border-b border-slate-200 bg-white">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div class="w-9 h-9 rounded-lg bg-blue-600 text-white flex items-center justify-center font-bold text-lg">
          M
        </div>
        <div>
          <div class="text-sm font-semibold">MedNote.AI</div>
          <div class="text-xs text-slate-500">Ghi lời bác sĩ → Hồ sơ bệnh án</div>
        </div>
      </div>
      <div class="text-xs text-slate-500">
        Chế độ: <span class="font-medium text-slate-700">Bác sĩ nội khoa</span>
      </div>
    </div>
  </header>

  <main class="flex-1 w-full">
    <div class="max-w-5xl mx-auto px-4 py-4 sm:py-6">

      <!-- STEPPER -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 mb-5 text-xs sm:text-sm">
        <button id="step-1" class="step-btn border border-slate-300 rounded-lg px-3 py-2 flex items-center gap-2">
          <span class="w-5 h-5 rounded-full border border-slate-400 flex items-center justify-center text-[11px]">1</span>
          Ghi âm
        </button>
        <button id="step-2" class="step-btn border border-slate-300 rounded-lg px-3 py-2 flex items-center gap-2">
          <span class="w-5 h-5 rounded-full border border-slate-400 flex items-center justify-center text-[11px]">2</span>
          Transcript
        </button>
        <button id="step-3" class="step-btn border border-slate-300 rounded-lg px-3 py-2 flex items-center gap-2">
          <span class="w-5 h-5 rounded-full border border-slate-400 flex items-center justify-center text-[11px]">3</span>
          Hồ sơ bệnh án
        </button>
      </div>

      <!-- PATIENT INFO -->
      <section id="patient-info-section" class="hidden mb-4 bg-white border border-slate-200 rounded-lg px-4 py-3 text-xs sm:text-sm">
        <div class="flex flex-wrap items-center gap-3">
          <div class="flex items-center gap-2">
            <span class="text-slate-500">Bệnh nhân:</span>
            <input id="pt-name" class="border border-slate-300 rounded px-2 py-1 w-40" />
          </div>
          <div class="flex items-center gap-2">
            <span class="text-slate-500">Tuổi:</span>
            <input id="pt-age" type="number" class="border border-slate-300 rounded px-2 py-1 w-16" />
          </div>
          <div class="flex items-center gap-2">
            <span class="text-slate-500">Mã HS:</span>
            <input id="pt-id" class="border border-slate-300 rounded px-2 py-1 w-32" />
          </div>
        </div>
      </section>

      <!-- SCREEN 0 – PATIENT SELECT -->
      <section id="screen-patient" class="screen">
        <div class="bg-white border border-slate-200 rounded-lg p-4 sm:p-5">
          <h2 class="text-lg font-semibold mb-3">Chọn bệnh nhân</h2>

          <div class="overflow-x-auto border border-slate-200 rounded-md">
            <table class="min-w-full text-sm">
              <thead class="bg-slate-50 border-b border-slate-200 text-slate-600 text-xs">
                <tr>
                  <th class="py-2 px-2 text-left">Tên bệnh nhân</th>
                  <th class="py-2 px-2 text-left">Tuổi</th>
                  <th class="py-2 px-2 text-left">Mã HS</th>
                  <th class="py-2 px-2 text-center">Chọn</th>
                </tr>
              </thead>
              <tbody id="patient-table-body">
                <tr class="border-b">
                  <td class="py-2 px-2">Nguyễn Văn A</td>
                  <td class="py-2 px-2">35</td>
                  <td class="py-2 px-2">2025-00123</td>
                  <td class="py-2 px-2 text-center">
                    <button class="select-patient px-3 py-1 rounded bg-blue-600 text-white text-xs"
                      data-name="Nguyễn Văn A" data-age="35" data-id="2025-00123">
                      Chọn
                    </button>
                  </td>
                </tr>
                <tr class="border-b">
                  <td class="py-2 px-2">Trần Thị B</td>
                  <td class="py-2 px-2">29</td>
                  <td class="py-2 px-2">2025-00124</td>
                  <td class="py-2 px-2 text-center">
                    <button class="select-patient px-3 py-1 rounded bg-blue-600 text-white text-xs"
                      data-name="Trần Thị B" data-age="29" data-id="2025-00124">
                      Chọn
                    </button>
                  </td>
                </tr>
                <tr class="border-b">
                  <td class="py-2 px-2">Lê Văn C</td>
                  <td class="py-2 px-2">52</td>
                  <td class="py-2 px-2">2025-00125</td>
                  <td class="py-2 px-2 text-center">
                    <button class="select-patient px-3 py-1 rounded bg-blue-600 text-white text-xs"
                      data-name="Lê Văn C" data-age="52" data-id="2025-00125">
                      Chọn
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- SCREEN 1 – RECORDING -->
      <section id="screen-record" class="screen hidden">
        <div class="bg-white border border-slate-200 rounded-lg p-4 sm:p-5">
          <h2 class="text-lg font-semibold mb-3">Ghi âm buổi khám</h2>

          <div class="flex gap-10 py-4 border-y mb-4">
            <div>
              <div class="text-xs text-slate-500 mb-1">Thời gian ghi</div>
              <div id="record-timer" class="text-4xl font-mono">00:00</div>
            </div>
            <div>
              <div class="text-xs text-slate-500 mb-1">Trạng thái</div>
              <div id="record-status" class="text-sm">Chưa bắt đầu</div>
            </div>
          </div>

          <button id="btn-toggle-record"
            class="px-4 py-2.5 rounded-md bg-red-600 text-white text-sm font-medium hover:bg-red-700">
            ▶️ Bắt đầu ghi
          </button>

          <button id="btn-goto-transcript"
            class="px-4 py-2.5 ml-3 rounded-md border border-slate-300 text-sm text-slate-700 hover:bg-slate-50 disabled:opacity-40"
            disabled>
            Chuyển sang Transcript →
          </button>
        </div>
      </section>

      <!-- SCREEN 2 – TRANSCRIPT -->
      <section id="screen-transcript" class="screen hidden">
        <div class="bg-white border border-slate-200 rounded-lg p-5">
          <h2 class="text-lg font-semibold mb-2">Transcript</h2>
          <textarea id="transcript-text"
            class="w-full min-h-[240px] border p-3 bg-slate-50 rounded-md text-sm">Bác sĩ: Chào anh...
Bệnh nhân: ...</textarea>

          <div class="flex justify-between mt-3">
            <button id="btn-back-record" class="text-xs text-slate-500 hover:text-slate-700">
              ← Quay lại ghi âm
            </button>

            <button id="btn-goto-note"
              class="px-4 py-2 rounded-md bg-blue-600 text-white text-sm font-medium hover:bg-blue-700">
              Tạo Hồ sơ bệnh án
            </button>
          </div>
        </div>
      </section>

      <!-- SCREEN 3 – MEDICAL NOTE -->
      <section id="screen-note" class="screen hidden">
        <div class="bg-white border border-slate-200 rounded-lg p-5">
          <h2 class="text-lg font-semibold mb-2">Hồ sơ bệnh án (SOAP)</h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

            <!-- S -->
            <div>
              <label class="text-sm font-semibold">S – Chủ quan</label>
              <textarea id="soap-s"
                class="w-full h-28 border p-2 mt-1 bg-slate-50 rounded-md text-sm">...</textarea>
            </div>

            <!-- O -->
            <div>
              <label class="text-sm font-semibold">O – Khách quan</label>
              <textarea id="soap-o"
                class="w-full h-28 border p-2 mt-1 bg-slate-50 rounded-md text-sm">...</textarea>
            </div>

            <!-- A -->
            <div>
              <label class="text-sm font-semibold">A – Nhận định</label>
              <textarea id="soap-a"
                class="w-full h-24 border p-2 mt-1 bg-slate-50 rounded-md text-sm">...</textarea>
            </div>

            <!-- P -->
            <div>
              <label class="text-sm font-semibold">P – Kế hoạch</label>
              <textarea id="soap-p"
                class="w-full h-24 border p-2 mt-1 bg-slate-50 rounded-md text-sm">...</textarea>
            </div>
          </div>

          <!-- ORDERS -->
          <div class="mt-4">
            <h3 class="text-sm font-semibold mb-1">Y lệnh</h3>
            <table class="min-w-full border text-xs">
              <thead class="bg-slate-50 border-b text-slate-600">
                <tr>
                  <th class="py-2 px-2 text-left">Thuốc/Dịch</th>
                  <th class="py-2 px-2 text-left">Liều</th>
                  <th class="py-2 px-2 text-left">Đường dùng</th>
                  <th class="py-2 px-2 text-left">Lịch dùng</th>
                </tr>
              </thead>
              <tbody id="orders-body">
                <tr class="border-b">
                  <td class="py-1 px-2"><input class="border w-full px-1" value="Paracetamol" /></td>
                  <td class="py-1 px-2"><input class="border w-full px-1" value="1g" /></td>
                  <td class="py-1 px-2"><input class="border w-full px-1" value="Uống" /></td>
                  <td class="py-1 px-2"><input class="border w-full px-1" value="Khi sốt" /></td>
                </tr>

                <!-- Add empty row -->
                <tr>
                  <td class="py-1 px-2"><input class="border w-full px-1" placeholder="Thêm thuốc..." /></td>
                  <td class="py-1 px-2"><input class="border w-full px-1" /></td>
                  <td class="py-1 px-2"><input class="border w-full px-1" /></td>
                  <td class="py-1 px-2"><input class="border w-full px-1" /></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="flex justify-between mt-4">
            <button id="btn-back-transcript-from-note" class="text-xs text-slate-500 hover:text-slate-700">
              ← Quay lại Transcript
            </button>

            <button id="btn-preview-note"
              class="px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700">Xem & Copy</button>
          </div>
        </div>
      </section>


      <!-- MODAL PREVIEW -->
      <div id="preview-modal" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg w-full max-w-2xl max-h-[80vh] flex flex-col">
          <div class="p-3 border-b flex justify-between items-center">
            <p class="text-sm font-semibold">Hồ sơ bệnh án (text thô)</p>
            <button id="btn-close-preview" class="text-sm">✕</button>
          </div>

          <pre id="preview-content"
               class="flex-1 p-3 bg-slate-50 overflow-auto text-xs whitespace-pre-wrap"></pre>

          <div class="p-3 border-t flex justify-end">
            <button id="btn-copy-note"
              class="px-3 py-2 bg-blue-600 text-white rounded-md text-xs hover:bg-blue-700">
              Copy vào clipboard
            </button>
          </div>
        </div>
      </div>

    </div>
  </main>
</div>


<script>
/* ---------------------------------------------------------
   STEP MANAGEMENT
--------------------------------------------------------- */
const screens = {
  patient: document.getElementById("screen-patient"),
  record: document.getElementById("screen-record"),
  transcript: document.getElementById("screen-transcript"),
  note: document.getElementById("screen-note"),
};

const steps = {
  1: document.getElementById("step-1"),
  2: document.getElementById("step-2"),
  3: document.getElementById("step-3"),
};

function setStep(step) {
  screens.patient.classList.toggle("hidden", step !== 0);
  screens.record.classList.toggle("hidden", step !== 1);
  screens.transcript.classList.toggle("hidden", step !== 2);
  screens.note.classList.toggle("hidden", step !== 3);

  Object.entries(steps).forEach(([k, btn]) => {
    btn.classList.toggle("step-active", Number(k) === step);
  });

  document.getElementById("patient-info-section").classList.toggle("hidden", step === 0);
}

setStep(0);

/* ---------------------------------------------------------
   PATIENT SELECT → AUTOFILL
--------------------------------------------------------- */
const inputName = document.getElementById("pt-name");
const inputAge = document.getElementById("pt-age");
const inputID = document.getElementById("pt-id");

document.querySelectorAll(".select-patient").forEach(btn => {
  btn.addEventListener("click", () => {
    inputName.value = btn.dataset.name;
    inputAge.value = btn.dataset.age;
    inputID.value = btn.dataset.id;
    setStep(1);
  });
});

/* ---------------------------------------------------------
   RECORDING DEMO LOGIC
--------------------------------------------------------- */
let rec = false, sec = 0, interval;
const timerEl = document.getElementById("record-timer");
const statusEl = document.getElementById("record-status");
const btnToggleRecord = document.getElementById("btn-toggle-record");
const btnGotoTranscript = document.getElementById("btn-goto-transcript");

btnToggleRecord.addEventListener("click", () => {
  rec = !rec;
  if (rec) {
    sec = 0;
    timerEl.textContent = "00:00";
    statusEl.textContent = "Đang ghi âm...";
    btnToggleRecord.textContent = "⏸ Dừng";
    btnToggleRecord.classList.replace("bg-red-600", "bg-red-700");
    btnGotoTranscript.disabled = true;

    interval = setInterval(() => {
      sec++;
      const m = String(Math.floor(sec / 60)).padStart(2, '0');
      const s = String(sec % 60).padStart(2, '0');
      timerEl.textContent = `${m}:${s}`;
    }, 1000);
  } else {
    clearInterval(interval);
    statusEl.textContent = "Đã dừng ghi.";
    btnToggleRecord.textContent = "▶️ Ghi lại";
    btnToggleRecord.classList.replace("bg-red-700", "bg-red-600");
    btnGotoTranscript.disabled = false;
  }
});

btnGotoTranscript.addEventListener("click", () => setStep(2));

/* ---------------------------------------------------------
   TRANSCRIPT
--------------------------------------------------------- */
document.getElementById("btn-back-record").addEventListener("click", () => setStep(1));
document.getElementById("btn-goto-note").addEventListener("click", () => setStep(3));

/* ---------------------------------------------------------
   NOTE (SOAP) + ORDERS
--------------------------------------------------------- */
document.getElementById("btn-back-transcript-from-note").addEventListener("click", () => setStep(2));

/* ---------------------------------------------------------
   PREVIEW
--------------------------------------------------------- */
const previewModal = document.getElementById("preview-modal");
const previewContent = document.getElementById("preview-content");

document.getElementById("btn-preview-note").addEventListener("click", () => {
  const text =
`HỒ SƠ BỆNH ÁN
BN: ${inputName.value}, ${inputAge.value} tuổi, HS: ${inputID.value}

S:
${document.getElementById("soap-s").value}

O:
${document.getElementById("soap-o").value}

A:
${document.getElementById("soap-a").value}

P:
${document.getElementById("soap-p").value}

Y LỆNH:
${Array.from(document.querySelectorAll("#orders-body tr"))
  .map(row => [...row.querySelectorAll("input")].map(x => x.value).join(", "))
  .filter(x => x.trim() !== ", , , ")
  .join("\n")}
`;

  previewContent.textContent = text;
  previewModal.classList.remove("hidden");
});

document.getElementById("btn-close-preview").addEventListener("click", () => {
  previewModal.classList.add("hidden");
});

/* ---------------------------------------------------------
   COPY NOTE
--------------------------------------------------------- */
document.getElementById("btn-copy-note").addEventListener("click", async () => {
  await navigator.clipboard.writeText(previewContent.textContent);
  alert("Đã copy hồ sơ bệnh án!");
});
</script>
</body>
</html>
